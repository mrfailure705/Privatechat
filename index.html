<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Private Chat</title><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script><style>
body{font-family:Arial;background:#f4f6f8;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
.chat-box{width:100%;max-width:420px;background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.1);display:flex;flex-direction:column}
.header{background:#EC0043;color:#fff;padding:12px;text-align:center;font-weight:bold;font-size:14px;border-radius:10px 10px 0 0}
.messages{flex:1;padding:10px;overflow-y:auto;font-size:14px}
.msg{margin-bottom:8px;padding:8px 12px;border-radius:8px;max-width:80%}
.me{background:#EC0043;color:#fff;margin-left:auto}
.other{background:#eee}
.status{font-size:11px;color:#666;padding:4px 10px}
.input-box{display:flex;border-top:1px solid #ddd}
input{flex:1;padding:12px;border:none;outline:none}
button{background:#EC0043;color:#fff;border:none;padding:0 18px;cursor:pointer}
</style></head>
<body><div class="chat-box">
  <div class="header" id="title">Private Chat</div>
  <div class="messages" id="messages"></div>
  <div class="status" id="status"></div>
  <div class="input-box">
    <input id="msg" placeholder="Type message..." oninput="typing(true)">
    <button onclick="sendMsg()">Send</button>
  </div>
</div><script>
const firebaseConfig = {
  apiKey: "AIzaSyCXZLGPwvqCN4OeZCjwBQan63pbASeSw8Y",
  authDomain: "chat-c504f.firebaseapp.com",
  databaseURL: "https://chat-c504f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "chat-c504f",
  storageBucket: "chat-c504f.firebasestorage.app",
  messagingSenderId: "550900239138",
  appId: "1:550900239138:web:5b1d1aede8684f335f337b"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();

const params=new URLSearchParams(location.search);
let room=params.get('room');

if(!room){
 room=Math.random().toString(36).substring(2,8);
 const pass=prompt('Set room password');
 db.ref('rooms/'+room).set({password:pass,users:0});
 alert('Share this link:\n'+location.origin+location.pathname+'?room='+room);
 history.replaceState({},'',`?room=${room}`);
}

const roomRef=db.ref('rooms/'+room);
const chatRef=db.ref('messages/'+room);
const typingRef=db.ref('typing/'+room);

let username=localStorage.getItem('chat_name')||prompt('Your name');
localStorage.setItem('chat_name',username);

roomRef.once('value',snap=>{
 if(!snap.exists()) return alert('Room not found');
 const data=snap.val();
 const entered=prompt('Enter room password');
 if(entered!==data.password) return alert('Wrong password'),location.reload();
 if(data.users>=2) return alert('Room full'),location.reload();
 roomRef.update({users:(data.users||0)+1});
});

window.addEventListener('beforeunload',()=>{
 roomRef.once('value',s=>{if(s.exists()) roomRef.update({users:Math.max(0,(s.val().users||1)-1)})});
});

function sendMsg(){
 const msg=document.getElementById('msg').value;
 if(!msg.trim()) return;
 chatRef.push({name:username,text:msg,time:Date.now(),seen:false});
 document.getElementById('msg').value='';
 typing(false);
}

chatRef.limitToLast(100).on('child_added',snap=>{
 const d=snap.val();
 const div=document.createElement('div');
 div.className='msg '+(d.name===username?'me':'other');
 div.textContent=d.name+': '+d.text;
 document.getElementById('messages').appendChild(div);
 snap.ref.update({seen:true});
});

function typing(val){ typingRef.set(val?username:null); }

typingRef.on('value',s=>{
 document.getElementById('status').textContent=s.val()?s.val()+' typing...':'';
});

// â³ Auto delete after 24 hours
chatRef.once('value',snap=>{
 snap.forEach(c=>{
  if(Date.now()-c.val().time>86400000) c.ref.remove();
 });
});

</script></body>
</html>